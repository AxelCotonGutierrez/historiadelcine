---
layout: default
title: Buscador
permalink: /Buscador/
description: Buscador de pel√≠culas, directores, actores, ...
comments: true
---

<div class="container" style="max-width: 900px;">
  <h1>üé¨ Buscador por categor√≠a</h1>

  <ul class="nav nav-tabs mb-3" id="pestanas-busqueda">
    <li class="nav-item"><a class="nav-link active" data-carpeta="por_directores" href="#">Directores</a></li>
    <li class="nav-item"><a class="nav-link" data-carpeta="por_productores" href="#">Productores</a></li>
    <li class="nav-item"><a class="nav-link" data-carpeta="por_guionistas" href="#">Guionistas</a></li>
    <li class="nav-item"><a class="nav-link" data-carpeta="por_actores" href="#">Actores</a></li>
    <li class="nav-item"><a class="nav-link" data-carpeta="por_estudio" href="#">Estudios</a></li>
    <li class="nav-item"><a class="nav-link" data-carpeta="por_paises" href="#">Pa√≠ses</a></li>
    <li class="nav-item"><a class="nav-link" data-carpeta="por_a√±o" href="#">A√±os</a></li>
  </ul>

  <input type="text" id="input-busqueda" class="form-control mb-3" placeholder="Buscar por nombre de categor√≠a (ej. Francia, Muybridge...)">

  <div id="resultados"></div>
</div>

<script>
const BASE_URL = "/historiadelcine/assets/js/json_generados/";
let carpetaActual = "";
let cache = {};

function cargarCarpeta(carpeta) {
  carpetaActual = carpeta;
  document.getElementById("resultados").innerHTML = "<p>Cargando datos...</p>";
  document.getElementById("input-busqueda").value = "";

  if (cache[carpeta]) {
    mostrarListado(cache[carpeta], "");
    return;
  }

  fetch(BASE_URL + carpeta + "/index.json")
    .then(r => r.json())
    .then(archivos => {
      const promesas = archivos.map(nombre =>
        fetch(BASE_URL + carpeta + "/" + nombre)
          .then(r => r.json())
          .catch(() => [])
      );

      Promise.all(promesas).then(resultados => {
        const todos = resultados.flat();

        // Eliminar duplicados por ID
        const unicos = [];
        const ids = new Set();
        for (const peli of todos) {
          if (!ids.has(peli.id)) {
            ids.add(peli.id);
            unicos.push(peli);
          }
        }

        cache[carpeta] = unicos;
        mostrarListado(unicos, "");
      });
    })
    .catch(() => {
      document.getElementById("resultados").innerHTML = "<p>Error al cargar datos.</p>";
    });
}

function mostrarListado(peliculas, filtroTexto) {
  const contenedor = document.getElementById("resultados");
  contenedor.innerHTML = "";

  const filtradas = peliculas.filter(p =>
    p.id?.toLowerCase().includes(filtroTexto) ||
    p.titulo?.toLowerCase().includes(filtroTexto) ||
    p.titulo_original?.toLowerCase().includes(filtroTexto)
  );

  if (filtradas.length === 0) {
    contenedor.innerHTML = "<p>No se encontraron resultados.</p>";
    return;
  }

  filtradas.forEach(p => {
    const div = document.createElement("div");
    div.className = "list-group-item";
    div.innerHTML = `
      <h5>${p.titulo} (${p.a√±o})</h5>
      <p><strong>Original:</strong> ${p.titulo_original || "‚Äî"}</p>
      <p><a href="${p.post}" class="btn btn-sm btn-outline-primary">Ver ficha completa</a></p>
    `;
    contenedor.appendChild(div);
  });
}

document.getElementById("input-busqueda").addEventListener("input", () => {
  const texto = document.getElementById("input-busqueda").value.toLowerCase().trim();
  if (cache[carpetaActual]) {
    mostrarListado(cache[carpetaActual], texto);
  }
});

document.querySelectorAll("#pestanas-busqueda .nav-link").forEach(tab => {
  tab.addEventListener("click", e => {
    e.preventDefault();
    document.querySelectorAll("#pestanas-busqueda .nav-link").forEach(el => el.classList.remove("active"));
    tab.classList.add("active");
    const carpeta = tab.getAttribute("data-carpeta");
    cargarCarpeta(carpeta);
  });
});
</script>
