---
layout: default
title: Etiquetas
permalink: /tags/
---

{% comment %}
Genera lista √∫nica de etiquetas a partir de todos los posts.
{% endcomment %}

{% assign tag_posts = site.posts | where_exp: "post", "post.tags.size > 0" %}

{% assign tags = "" %}
{% for post in tag_posts %}
  {% assign tags = tags | concat: post.tags | uniq %}
{% endfor %}

{% assign sorted_tags = tags | sort %}

<style>
  /* üîç Caja de b√∫squeda */
  #tag-search {
    width: 100%;
    max-width: 400px;
    padding: 0.6em 1em;
    font-size: 1rem;
    border: 2px solid #ccc;
    border-radius: 8px;
    margin-bottom: 1em;
  }

  /* üìã Lista de sugerencias */
  #tag-results {
    list-style: none;
    padding: 0;
    margin: 0;
    max-width: 400px;
    border: 1px solid #ddd;
    border-radius: 8px;
    overflow: hidden;
  }

  #tag-results li {
    padding: 0.5em 1em;
    border-bottom: 1px solid #eee;
    cursor: pointer;
    background: #fff;
    transition: background 0.2s;
  }

  #tag-results li:hover {
    background: #f0f0f0;
  }

  /* üìö Contenido de posts relacionados */
  .related-posts {
    margin-top: 2em;
    display: none;
  }

  .related-posts h4 {
    margin-bottom: 0.5em;
  }

  .related-posts ul {
    padding-left: 1.2em;
  }

  .related-posts ul li {
    margin-bottom: 0.3em;
  }
</style>

<h2>0.1. Buscar etiqueta:</h2>
<input type="text" id="tag-search" placeholder="Empieza a escribir...">
<ul id="tag-results"></ul>

<!-- üîó Bloques de posts relacionados, uno por etiqueta -->
{% for tag in sorted_tags %}
  <div id="{{ tag | slugify }}" class="related-posts">
    <h4>{{ tag }}</h4>
    <ul>
      {% assign tag_related_posts = tag_posts | where: "tags", tag %}
      {% for post in tag_related_posts %}
        <li>
          <a href="{{ site.baseurl }}{{ post.url }}">{{ post.title }}</a>
        </li>
      {% endfor %}
    </ul>
  </div>
{% endfor %}

<script>
   const tags = JSON.parse('{{ sorted_tags | jsonify | escape }}');
  const input = document.getElementById('tag-search');
  const results = document.getElementById('tag-results');

  input.addEventListener('input', () => {
    const query = input.value.toLowerCase().trim();
    results.innerHTML = "";
    if (query.length === 0) return;

    const matches = tags.filter(t => t.toLowerCase().includes(query));
    matches.forEach(tag => {
      const li = document.createElement('li');
      li.textContent = tag;
      li.onclick = () => {
        mostrarPostsDeTag(tag);
        results.innerHTML = "";
        input.value = tag;
      };
      results.appendChild(li);
    });
  });

  function mostrarPostsDeTag(tag) {
    const slug = tag.toLowerCase().replace(/\s+/g, "-");
    document.querySelectorAll('.related-posts').forEach(div => {
      div.style.display = 'none';
    });
    const container = document.getElementById(slug);
    if (container) {
      container.style.display = 'block';
    } else {
      console.warn("No existe contenedor para:", slug);
    }
  }

  // Permitir abrir directo con ?tag= en la URL
  const params = new URLSearchParams(window.location.search);
  if (params.has("tag")) {
    mostrarPostsDeTag(params.get("tag").replace(/-/g, " "));
  }
</script>
