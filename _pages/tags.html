---
layout: default
title: Etiquetas
permalink: /tags/
---

{% assign tag_posts = site.posts | where_exp: "post", "post.tags.size > 0" %}

{% assign tags = "" %}
{% for post in tag_posts %}
  {% assign tags = tags | concat: post.tags | uniq %}
{% endfor %}

{% assign sorted_tags = tags | sort %}

<h3>Buscar etiqueta:</h3>
<input id="tag-input" placeholder="Escribe parte de la etiqueta..." style="width: 300px; padding: 5px;" />
<div id="suggestions" style="border: 1px solid #ccc; max-width: 300px;"></div>

<!-- Contenedor de resultados -->
<div id="tag-results"></div>

<!-- Todos los divs de posts por etiqueta (ocultos) -->
{% for tag in sorted_tags %}
  <div id="tag-{{ tag | slugify }}" style="display: none;">
    <h4>{{ tag }}</h4>
    <ul>
      {% assign tag_related_posts = tag_posts | where: "tags", tag %}
      {% for post in tag_related_posts %}
        <li><a href="{{ site.baseurl }}{{ post.url }}">{{ post.title }}</a></li>
      {% endfor %}
    </ul>
  </div>
{% endfor %}

<script>
  const allTags = [{% for tag in sorted_tags %}"{{ tag }}"{% unless forloop.last %}, {% endunless %}{% endfor %}];
  const input = document.getElementById('tag-input');
  const suggestions = document.getElementById('suggestions');
  const results = document.getElementById('tag-results');

  input.addEventListener('input', function() {
    const text = this.value.toLowerCase();
    suggestions.innerHTML = '';

    if (text.length < 1) return;

    const matches = allTags.filter(tag => tag.toLowerCase().includes(text));
    matches.forEach(tag => {
      const div = document.createElement('div');
      div.textContent = tag;
      div.style.padding = '5px';
      div.style.cursor = 'pointer';
      div.addEventListener('click', function() {
        // Oculta sugerencias
        suggestions.innerHTML = '';
        input.value = tag;

        // Muestra resultados
        results.innerHTML = '';
        const divRes = document.getElementById('tag-' + tag.replace(/ /g,'-').toLowerCase());
        if (divRes) {
          results.appendChild(divRes.cloneNode(true));
        }
      });
      suggestions.appendChild(div);
    });
  });

  // Opcional: limpiar sugerencias si clicas fuera
  document.addEventListener('click', function(e) {
    if (e.target !== input) suggestions.innerHTML = '';
  });
</script>
